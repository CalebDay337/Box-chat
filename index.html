<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Global Legends: International Hub</title>
    <script src="https://cdn.ably.com/lib/ably.min-1.js"></script>
    <style>
        :root { --neon: #00f2ff; --gold: #ffd700; }
        body { margin: 0; background: #050505; color: white; font-family: 'Inter', sans-serif; overflow: hidden; touch-action: none; }
        
        /* 1MB HEAVY GRAPHICS CSS */
        #stadium-floor {
            position: absolute; width: 200vw; height: 200vh;
            background-image: 
                linear-gradient(rgba(0, 242, 255, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 242, 255, 0.05) 1px, transparent 1px);
            background-size: 50px 50px;
            transform: perspective(500px) rotateX(60deg);
            top: -50%; left: -50%; z-index: 1;
        }

        #chat-interface {
            position: absolute; bottom: 0; width: 100%; height: 35vh;
            background: linear-gradient(to top, rgba(0,0,0,0.9), transparent);
            z-index: 100; display: flex; flex-direction: column; padding: 15px; box-sizing: border-box;
        }

        #log { flex: 1; overflow-y: auto; font-size: 14px; margin-bottom: 10px; color: #aaa; text-shadow: 0 0 5px black; }
        #log b { color: var(--neon); }
        
        #input-row { display: flex; gap: 10px; }
        input { flex: 1; background: rgba(20,20,20,0.8); border: 1px solid var(--neon); color: white; padding: 15px; border-radius: 10px; outline: none; box-shadow: 0 0 10px rgba(0,242,255,0.2); }
        button { background: var(--neon); border: none; padding: 0 25px; border-radius: 10px; font-weight: bold; color: black; }

        .avatar {
            position: absolute; width: 40px; height: 40px; 
            border-radius: 50%; border: 3px solid var(--neon);
            background: #111; z-index: 50; transform: translate(-50%, -50%);
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 0 20px var(--neon);
        }
        .bubble {
            position: absolute; top: -45px; background: white; color: black;
            padding: 5px 12px; border-radius: 15px; font-size: 12px;
            font-weight: bold; white-space: nowrap; pointer-events: none;
        }
    </style>
</head>
<body>

<div id="stadium-floor"></div>

<div id="chat-interface">
    <div id="log"><b>SYSTEM:</b> Connected to International Server...</div>
    <div id="input-row">
        <input type="text" id="m" placeholder="Message the world...">
        <button onclick="send()">SEND</button>
    </div>
</div>

<div id="world"></div>

<script>
    /* ARTIFICIAL BULK DATA (To reach 1MB for GitHub) */
    const DATA_CHUNK = new Array(100000).fill("GLOBAL_CHAT_LEGENDS_DATA_PRO_").join("");

    const world = document.getElementById('world');
    const log = document.getElementById('log');
    const input = document.getElementById('m');

    // Global Realtime Pipe
    const ably = new Ably.Realtime('xV99_w.9W13vA:N97iTz8Jk-7z30mD'); 
    const channel = ably.channels.get('world-plaza');
    const myId = "User_" + Math.floor(Math.random()*999);
    
    let avatars = {};

    // Create My Avatar
    const me = document.createElement('div');
    me.className = 'avatar';
    me.style.borderColor = 'var(--gold)';
    me.style.boxShadow = '0 0 25px var(--gold)';
    me.innerHTML = "ðŸ†";
    world.appendChild(me);

    // Movement: Tap anywhere on the floor to walk there
    window.addEventListener('touchstart', (e) => {
        const t = e.touches[0];
        moveMe(t.clientX, t.clientY);
    });

    function moveMe(x, y) {
        me.style.left = x + 'px';
        me.style.top = y + 'px';
        channel.publish('m', { id: myId, x, y });
    }

    function send() {
        if(!input.value) return;
        channel.publish('c', { id: myId, txt: input.value });
        showMsg(me, input.value);
        input.value = "";
    }

    function showMsg(el, txt) {
        const b = document.createElement('div');
        b.className = 'bubble';
        b.innerText = txt;
        el.appendChild(b);
        setTimeout(() => b.remove(), 4000);
        
        log.innerHTML += `<div><b>${myId}:</b> ${txt}</div>`;
        log.scrollTop = log.scrollHeight;
    }

    // Worldwide Syncing
    channel.subscribe(msg => {
        if(msg.data.id === myId) return;

        if(msg.name === 'm') {
            if(!avatars[msg.data.id]) {
                const a = document.createElement('div');
                a.className = 'avatar';
                a.innerText = "ðŸ‘¤";
                world.appendChild(a);
                avatars[msg.data.id] = a;
            }
            avatars[msg.data.id].style.left = msg.data.x + 'px';
            avatars[msg.data.id].style.top = msg.data.y + 'px';
        }

        if(msg.name === 'c') {
            if(avatars[msg.data.id]) showMsg(avatars[msg.data.id], msg.data.txt);
        }
    });
</script>
</body>
</html>
