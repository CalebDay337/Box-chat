<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Football Legends: Global Hub</title>
    <script src="https://cdn.ably.com/lib/ably.min-1.js"></script>
    <style>
        :root { --neon: #00f2ff; --gold: #ffd700; --red: #ff4444; }
        body { margin: 0; background: #000; color: white; font-family: 'Segoe UI', sans-serif; overflow: hidden; touch-action: none; }
        
        /* LOGIN OVERLAY */
        #auth-overlay {
            position: fixed; inset: 0; background: #0a0a0a; z-index: 1000;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .auth-card {
            background: #111; padding: 30px; border-radius: 20px; border: 1px solid var(--neon);
            text-align: center; box-shadow: 0 0 30px rgba(0,242,255,0.2); width: 80%;
        }
        input { 
            width: 100%; padding: 15px; margin: 10px 0; border-radius: 10px; 
            border: 1px solid #333; background: #000; color: white; box-sizing: border-box;
        }
        .btn { 
            width: 100%; padding: 15px; border-radius: 10px; border: none; 
            font-weight: bold; cursor: pointer; margin-top: 10px;
        }
        #login-btn { background: var(--neon); color: #000; }

        /* HUD & UI */
        #friends-list {
            position: absolute; top: 10px; right: 10px; width: 120px;
            background: rgba(0,0,0,0.7); border-radius: 10px; padding: 10px; font-size: 12px; z-index: 100;
        }
        .friend-item { color: var(--neon); margin-bottom: 5px; border-bottom: 1px solid #333; }

        /* GAME ELEMENTS */
        .avatar {
            position: absolute; width: 45px; height: 45px; z-index: 50;
            transform: translate(-50%, -50%); transition: top 0.2s, left 0.2s;
        }
        .legend-sprite {
            width: 30px; height: 35px; background: var(--gold); 
            border-radius: 5px; position: relative; margin: 0 auto;
        }
        .helmet { width: 18px; height: 18px; background: #333; border-radius: 50%; position: absolute; top: -12px; left: 6px; }
        .username-tag { position: absolute; bottom: -20px; font-size: 10px; white-space: nowrap; left: 50%; transform: translateX(-50%); }
    </style>
</head>
<body>

<div id="auth-overlay">
    <div class="auth-card">
        <h1 style="color:var(--neon)">FOOTBALL LEGENDS</h1>
        <p>International Social Hub</p>
        <input type="text" id="username" placeholder="Enter Legend Name...">
        <button class="btn" id="login-btn" onclick="login()">ENTER STADIUM</button>
    </div>
</div>

<div id="friends-list">
    <b style="color:white">ONLINE (0)</b>
    <div id="friends-box"></div>
</div>

<div id="world" style="width:100vw; height:100vh; background:#1a1a1a;"></div>

<script>
    /* 1MB DATA FILLER */
    const MASSIVE_DATA = new Array(80000).fill("STADIUM_ASSET_777_").join("");

    let myName = localStorage.getItem('legendName') || "";
    let avatars = {};

    if(myName) {
        document.getElementById('username').value = myName;
    }

    const ably = new Ably.Realtime('xV99_w.9W13vA:N97iTz8Jk-7z30mD');
    const channel = ably.channels.get('global-chat');

    function login() {
        const userVal = document.getElementById('username').value;
        if(!userVal) return alert("Enter a Name!");
        
        myName = userVal;
        localStorage.setItem('legendName', myName); // SAVE PROGRESS
        document.getElementById('auth-overlay').style.display = 'none';
        
        // Connect and announce presence
        channel.presence.enter({ name: myName });
    }

    function createAvatar(id, name, isMe) {
        const div = document.createElement('div');
        div.className = 'avatar';
        div.innerHTML = `
            <div class="helmet"></div>
            <div class="legend-sprite" style="background:${isMe ? 'var(--gold)' : 'var(--neon)'}"></div>
            <div class="username-tag">${name}</div>
        `;
        document.getElementById('world').appendChild(div);
        return div;
    }

    // Syncing movement worldwide
    window.addEventListener('touchstart', (e) => {
        if(!myName) return;
        const t = e.touches[0];
        channel.publish('move', { id: myId, x: t.clientX, y: t.clientY, name: myName });
        updateMyPos(t.clientX, t.clientY);
    });

    const myId = Math.random().toString(36).substring(7);
    let myAvatar = null;

    function updateMyPos(x, y) {
        if(!myAvatar) myAvatar = createAvatar(myId, myName, true);
        myAvatar.style.left = x + 'px';
        myAvatar.style.top = y + 'px';
    }

    // Worldwide Friends/Presence Logic
    channel.presence.subscribe('enter', (member) => {
        updateFriendsList();
    });

    function updateFriendsList() {
        channel.presence.get((err, members) => {
            const box = document.getElementById('friends-box');
            box.innerHTML = "";
            members.forEach(m => {
                box.innerHTML += `<div class="friend-item">‚óè ${m.data.name || 'Anonymous'}</div>`;
            });
            document.querySelector('#friends-list b').innerText = `ONLINE (${members.length})`;
        });
    }

    channel.subscribe('move', (m) => {
        if(m.data.id === myId) return;
        if(!avatars[m.data.id]) avatars[m.data.id] = createAvatar(m.data.id, m.data.name, false);
        avatars[m.data.id].style.left = m.data.x + 'px';
        avatars[m.data.id].style.top = m.data.y + 'px';
    });
</script>
</body>
</html>
